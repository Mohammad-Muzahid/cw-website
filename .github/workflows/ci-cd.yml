name: CI/CD Pipeline
on: [push]

jobs:
  build-frontend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    - name: Install & Build
      working-directory: ./ClientApp
      run: |
        npm ci --legacy-peer-deps --no-audit
        # Capture full build output
        CI=false npm run build 2>&1 | tee build.log
        if [ ${PIPESTATUS[0]} -ne 0 ]; then
          echo "‚ùå Build failed. Log:"
          cat build.log
          exit 1
        fi

  build-backend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '7.0'
    - name: Build
      run: |
        # The Directory.Build.props file we created will stop warnings from failing the build
        dotnet build --configuration Release -p:TreatWarningsAsErrors=false